#!/usr/bin/env ruby
# An example of how to use the bloodymines game egnine within a curses program.

require File.dirname(__FILE__) + "/../lib/bloodymines"
require File.dirname(__FILE__) + "/../lib/bloodymines/tui"

class Bloodymines
  include TUI
end

# main app
puts "Welcome to bloodymines!"
print "Choose your difficulty: [1]Beginner, [2]Intermediate, [3]Expert > "

case gets.chomp.to_i
when 2: game = Bloodymines.new(:difficulty => :intermediate)
when 3: game = Bloodymines.new(:difficulty => :expert)
else game = Bloodymines.new
end

game.cursor_x = 0
game.cursor_y = 0

Curses.program do |scr|
  while true
    game.draw_field
    case getch
    when Key::UP : game.move(:direction => :up)
    when Key::DOWN : game.move(:direction => :down)
    when Key::LEFT : game.move(:direction => :left)
    when Key::RIGHT : game.move(:direction => :right)
    when 32 : game.uncover(game.cursor_x, game.cursor_y)
    when 27, ?q, ?Q : break
    end
    if game.ended?
      game.draw_field
      setpos(0, 1)
      addstr("Game Over. Hit any key to quit.")
      getch
      break
    end
  end

 close_screen
 if game.result[:finished]
   puts "You completed the game on #{game.difficulty.to_s.upcase}!"
 else
   puts "You did not manage to finish the game."
 end
 puts "Your final score was: #{game.result[:score]}"
end
